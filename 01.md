# Create a cluster

![cluster](https://d33wubrfki0l68.cloudfront.net/99d9808dcbf2880a996ed50d308a186b5900cec9/40b94/docs/tutorials/kubernetes-basics/public/images/module_01_cluster.svg)

## Using minikube (Mac)
1. Get minikube version, command:
    ```
    $ minikube version
    ```
    Response:
    ```
    minikube version: v1.5.2
    commit: 792dbf92a1de583fcee76f8791cff12e0c9440ad
    ```
  
2. Start a minikube cluster, command:
    ```
    $ minikube start
    ```
    Response:
    ```
    üòÑ  minikube v1.5.2 on Darwin 10.15.1
    üî•  Creating virtualbox VM (CPUs=2, Memory=2000MB, Disk=20000MB) ...
    üê≥  Preparing Kubernetes v1.16.2 on Docker '18.09.9' ...
    üöú  Pulling images ...
    üöÄ  Launching Kubernetes ...
    ‚åõ  Waiting for: apiserver
    üèÑ  Done! kubectl is now configured to use "minikube"
    ```
3. Get cluster version, command:
    ```
    $ kubectl version
    ```
    Response:
    ```
    Client Version: version.Info{Major:"1", Minor:"16", GitVersion:"v1.16.3", GitCommit:"b3cbbae08ec52a7fc73d334838e18d17e8512749", GitTreeState:"clean", BuildDate:"2019-11-14T04:24:29Z", GoVersion:"go1.12.13", Compiler:"gc", Platform:"darwin/amd64"}
    Server Version: version.Info{Major:"1", Minor:"16", GitVersion:"v1.16.2", GitCommit:"c97fe5036ef3df2967d086711e6c0c405941e14b", GitTreeState:"clean", BuildDate:"2019-10-15T19:09:08Z", GoVersion:"go1.12.10", Compiler:"gc", Platform:"linux/amd64"}
    ```
4. Get cluster detail information, command:
    ```
    $ kubectl cluster-info
    ```
    Response:
    ```
    Kubernetes master is running at https://192.168.99.107:8443
    KubeDNS is running at https://192.168.99.107:8443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy

    To further debug and diagnose cluster problems, use 'kubectl cluster-info dump'.
    ```
5. View the nodes in the cluster, command:
    ```
    $ kubectl get nodes
    ```
    Response:
    ```
    NAME       STATUS   ROLES    AGE   VERSION
    minikube   Ready    master   18m   v1.16.2
    ```

## Using Ubuntu
1. Install kubernetes:
    ```
    $ sudo apt-get install -y kubelet kubeadm kubectl kubernetes-cni
    ```
2. Pass bridged IPv4 traffic to iptables chains:
    ```
    $ sysctl net.bridge.bridge-nf-call-iptables=1
    ```
3. Create cluster:
    ```
    $ sudo kubeadm init --pod-network-cidr=192.168.0.0/16
    ```
4. Make as non-root user:
    ```
    $ mkdir -p $HOME/.kube
    $ sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
    $ sudo chown $(id -u):$(id -g) $HOME/.kube/config
    ```
5. Install calico:
    ```
    $ kubectl apply -f https://docs.projectcalico.org/v3.10/manifests/calico.yaml
    ```
    Response:
    ```
    configmap/calico-config created
    customresourcedefinition.apiextensions.k8s.io/felixconfigurations.crd.projectcalico.org created
    customresourcedefinition.apiextensions.k8s.io/ipamblocks.crd.projectcalico.org created
    customresourcedefinition.apiextensions.k8s.io/blockaffinities.crd.projectcalico.org created
    customresourcedefinition.apiextensions.k8s.io/ipamhandles.crd.projectcalico.org created
    customresourcedefinition.apiextensions.k8s.io/ipamconfigs.crd.projectcalico.org created
    customresourcedefinition.apiextensions.k8s.io/bgppeers.crd.projectcalico.org created
    customresourcedefinition.apiextensions.k8s.io/bgpconfigurations.crd.projectcalico.org created
    customresourcedefinition.apiextensions.k8s.io/ippools.crd.projectcalico.org created
    customresourcedefinition.apiextensions.k8s.io/hostendpoints.crd.projectcalico.org created
    customresourcedefinition.apiextensions.k8s.io/clusterinformations.crd.projectcalico.org created
    customresourcedefinition.apiextensions.k8s.io/globalnetworkpolicies.crd.projectcalico.org created
    customresourcedefinition.apiextensions.k8s.io/globalnetworksets.crd.projectcalico.org created
    customresourcedefinition.apiextensions.k8s.io/networkpolicies.crd.projectcalico.org created
    customresourcedefinition.apiextensions.k8s.io/networksets.crd.projectcalico.org created
    clusterrole.rbac.authorization.k8s.io/calico-kube-controllers created
    clusterrolebinding.rbac.authorization.k8s.io/calico-kube-controllers created
    clusterrole.rbac.authorization.k8s.io/calico-node created
    clusterrolebinding.rbac.authorization.k8s.io/calico-node created
    daemonset.apps/calico-node created
    serviceaccount/calico-node created
    deployment.apps/calico-kube-controllers created
    serviceaccount/calico-kube-controllers created
    ```
6. Confirm that all of the pods are running:
    ```
    $ watch kubectl get pods --all-namespaces
    ```
    Response:
    ```
    Every 2.0s: kubectl get pods --all-namespaces                                                 ubuntu: Tue Dec 17 10:07:51 2019

    NAMESPACE     NAME                                       READY   STATUS    RESTARTS   AGE
    kube-system   calico-kube-controllers-74c9747c46-djvcj   1/1     Running   0          7m28s
    kube-system   calico-node-r2fzl                          1/1     Running   0          7m28s
    kube-system   coredns-6955765f44-f6jnm                   1/1     Running   0          7m50s
    kube-system   coredns-6955765f44-kkj2w                   1/1     Running   0          7m49s
    kube-system   etcd-ubuntu                                1/1     Running   0          7m46s
    kube-system   kube-apiserver-ubuntu                      1/1     Running   0          7m46s
    kube-system   kube-controller-manager-ubuntu             1/1     Running   0          7m46s
    kube-system   kube-proxy-5d5xh                           1/1     Running   0          7m50s
    kube-system   kube-scheduler-ubuntu                      1/1     Running   0          7m46s
    ```
7. Remove the taints:
    ```
    $ kubectl taint nodes --all node-role.kubernetes.io/master-
    ```
    Response:
    ```
    node/ubuntu untainted
    ```
8. Confirm that you now have a node:
    ```
    $ kubectl get nodes -o wide
    ```
    Response:
    ```
    NAME     STATUS   ROLES    AGE   VERSION   INTERNAL-IP   EXTERNAL-IP   OS-IMAGE             KERNEL-VERSION      CONTAINER-RUNTIME
    ubuntu   Ready    master   20m   v1.17.0   10.0.2.15     <none>        Ubuntu 18.04.3 LTS   4.15.0-55-generic   docker://18.9.7
    ```
